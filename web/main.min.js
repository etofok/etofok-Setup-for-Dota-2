function loadLazySection(e){const t=e.dataset.src;t&&fetch(t).then(e=>{if(!e.ok)throw new Error(`HTTP error: ${e.status}`);return e.text()}).then(t=>{const n=document.createElement("div");n.innerHTML=t,e.replaceWith(...n.childNodes)}).catch(e=>console.error(`Failed to load ${t}:`,e))}function toggleDonatePanel(e){e.preventDefault();const t=document.getElementById("donateOverlay");"flex"===t.style.display?(t.style.display="none",history.state&&history.state.panelOpen&&history.replaceState({},document.title,window.location.pathname+window.location.search)):(t.style.display="flex",history.pushState({panelOpen:!0},"Donate Panel Open","#donate-panel-open"))}(()=>{const e=document.querySelectorAll(".lazy-section"),t=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target,o=n.getAttribute("data-src");o&&fetch(o).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.text()}).then(e=>{n.innerHTML=e,n.classList.add("loaded"),t.unobserve(n)}).catch(e=>{console.error(`Error loading ${o}:`,e),n.innerHTML='<p style="color:red;">Failed to load content.</p>'})}})},{rootMargin:"600px",threshold:.1});e.forEach(e=>t.observe(e))})(),document.addEventListener("click",e=>{const t=e.target.closest(".magnifiable");if(!t)return;let n=document.querySelector(".magnify-overlay");if(!n){n=document.createElement("div"),n.classList.add("magnify-overlay"),document.body.appendChild(n);const e=document.createElement("img");n.appendChild(e)}n.querySelector("img").src=t.src,n.classList.add("active")}),document.addEventListener("click",e=>{const t=document.querySelector(".magnify-overlay");t&&e.target===t&&(t.classList.remove("active"),setTimeout(()=>{t.querySelector("img").src=""},300))}),document.addEventListener("keydown",e=>{const t=document.querySelector(".magnify-overlay");"Escape"===e.key&&t?.classList.contains("active")&&t.classList.remove("active")}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".lazy-section"),t=document.getElementById("table-of-contents");e.forEach(e=>{const n=e.dataset.section;if(!n)return;if(!/^section-\d/.test(n))return;e.id||(e.id=n);const o=n.replace(/^section-/,""),[a,...r]=o.split("-"),c=r.join(" "),s=c.charAt(0).toUpperCase()+c.slice(1),l=document.createElement("li");l.innerHTML=`<b>${a}.</b> <a href="#${e.id}">${s}</a>`,t.appendChild(l)})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".navbar");function t(){window.scrollY>=0?e.classList.add("scrolled"):e.classList.remove("scrolled")}window.addEventListener("scroll",t),t(),window.addEventListener("popstate",e=>{const t=document.getElementById("donateOverlay");"flex"!==t.style.display||e.state&&e.state.panelOpen||(t.style.display="none")})}),document.addEventListener("click",e=>{e.target.closest("#donateOverlay")&&toggleDonatePanel(e)}),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("placeholder-panel-donate");e&&fetch("html/panel-donate.html").then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.text()}).then(t=>{const n=document.createElement("div");n.innerHTML=t,e.replaceWith(...n.childNodes)}).catch(e=>{console.error("Failed to load overlay:",e)})});