function loadLazySection(e){const t=e.dataset.src;t&&fetch(t).then(e=>{if(!e.ok)throw new Error(`HTTP error: ${e.status}`);return e.text()}).then(t=>{const n=document.createElement("div");n.innerHTML=t,e.replaceWith(...n.childNodes)}).catch(e=>console.error(`Failed to load ${t}:`,e))}function ensureOverlay(){let e=document.querySelector(".magnify-overlay");if(e)return e;e=document.createElement("div"),e.className="magnify-overlay",e.setAttribute("role","dialog"),e.setAttribute("aria-hidden","true");const t=document.createElement("img");return e.appendChild(t),e.addEventListener("click",()=>{e.classList.remove("active"),e.setAttribute("aria-hidden","true"),setTimeout(()=>{e.querySelector("img").src=""},300)}),document.body.appendChild(e),e}function toggleDonatePanel(e){e.preventDefault();const t=document.getElementById("donateOverlay");"flex"===t.style.display?(t.style.display="none",history.state&&history.state.panelOpen&&history.replaceState({},document.title,window.location.pathname+window.location.search)):(t.style.display="flex",history.pushState({panelOpen:!0},"Donate Panel Open","#donate-panel-open"))}(()=>{const e=document.querySelectorAll(".lazy-section"),t=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target,o=n.getAttribute("data-src");o&&fetch(o).then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.text()}).then(e=>{n.innerHTML=e,n.classList.add("loaded"),t.unobserve(n)}).catch(e=>{console.error(`Error loading ${o}:`,e),n.innerHTML='<p style="color:red;">Failed to load content.</p>'})}})},{rootMargin:"600px",threshold:.1});e.forEach(e=>t.observe(e))})(),document.addEventListener("click",e=>{const t=e.target.closest(".magnifiable");if(!t)return;const n=ensureOverlay();n.querySelector("img").src=t.src,n.setAttribute("aria-hidden","false"),n.classList.add("active")}),document.addEventListener("keydown",e=>{const t=document.querySelector(".magnify-overlay");"Escape"===e.key&&t?.classList.contains("active")&&(t.classList.remove("active"),t.setAttribute("aria-hidden","true"),setTimeout(()=>{t.querySelector("img").src=""},300))}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelectorAll(".lazy-section"),t=document.getElementById("table-of-contents");e.forEach(e=>{const n=e.dataset.section;if(!n)return;if(!/^section-\d/.test(n))return;e.id||(e.id=n);const o=n.replace(/^section-/,""),[r,...a]=o.split("-"),s=a.join(" "),c=s.charAt(0).toUpperCase()+s.slice(1),d=document.createElement("li");d.innerHTML=`<b>${r}.</b> <a href="#${e.id}">${c}</a>`,t.appendChild(d)})}),document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".navbar");function t(){window.scrollY>=0?e.classList.add("scrolled"):e.classList.remove("scrolled")}window.addEventListener("scroll",t),t(),window.addEventListener("popstate",e=>{const t=document.getElementById("donateOverlay");"flex"!==t.style.display||e.state&&e.state.panelOpen||(t.style.display="none")})}),document.addEventListener("click",e=>{e.target.closest("#donateOverlay")&&toggleDonatePanel(e)}),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("placeholder-panel-donate");e&&fetch("html/panel-donate.html").then(e=>{if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);return e.text()}).then(t=>{const n=document.createElement("div");n.innerHTML=t,e.replaceWith(...n.childNodes)}).catch(e=>{console.error("Failed to load overlay:",e)})});